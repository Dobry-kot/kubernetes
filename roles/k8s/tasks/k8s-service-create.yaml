- name: BLCOK SERVICES.
  block:
    - name: COPY SERVICES.
      ansible.builtin.template:
        src: "services/{{ service_name }}"
        dest: /etc/systemd/system/{{ service_name }}
        owner: root
        group: root
        mode: '0775'
      loop: "{{ services_list }}"
      loop_control:
          loop_var: service_name
      register: service_status

    - name: RESTART SERVICES IF CHANGED.
      block:
        - name: DAEMON-RELOAD.
          ansible.builtin.systemd:
            daemon_reload: yes

        - name: RESTART SERVICE <{{ k8s_component }}>.
          service:
            name: "{{ serive_changed.service_name }}"
            state: "{{ service_state | default('restarted') }}"
            enabled: "{{ service_enabled | default('true') }}"
          loop: "{{ service_status.results }}"
          loop_control:
              loop_var: serive_changed

      when: service_status.changed | bool or 
            service_state is defined
  tags:
    - update_services